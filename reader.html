<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Reading - Eink-It</title>
  <link rel="manifest" href="manifest.json">

  <!-- Favicons -->
  <link rel="icon" href="/icons/favicon.ico">
  <link rel="icon" type="image/svg+xml" href="/icons/favicon.svg">
  <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">

  <!-- Apple Touch Icons -->
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/icon-180.png">

  <!-- Windows Tile -->
  <meta name="msapplication-TileColor" content="#000000">
  <meta name="msapplication-TileImage" content="/icons/icon-192.png">

  <link rel="stylesheet" href="css/reader.css">
</head>
<body>
      <div id="reader-container">
        <header id="reader-header">
          <div style="display: flex; align-items: center; gap: 10px;">
            <h1 id="article-title">Loading...</h1>
            <span id="offlineBadge" class="offline-badge" style="display: none; font-size: 12px; padding: 2px 8px;">Offline</span>
          </div>
          <div id="article-meta">
            <span id="article-byline" class="meta-item"></span>
            <span id="meta-divider-byline-site" class="meta-divider" aria-hidden="true">•</span>
            <span id="article-site" class="meta-item"></span>
          </div>
        </header>

        <main id="reader-content">
          <!-- Article content will be dynamically inserted here -->
        </main>

        <footer id="reader-footer">
          <div class="left-controls">
            <button id="back-btn" title="Back to List">← Back</button>
          </div>
          <div class="center-controls">
            <button id="settings-btn" title="Settings">A</button>
            <button id="dark-mode-btn" title="Toggle Dark Mode">◐</button>
          </div>
          <div class="right-controls">
            <button id="page-info-btn" title="Jump to Page">
              <span id="current-page">1</span> / <span id="total-pages">1</span>
            </button>
          </div>
    </footer>
    <!-- Hot zone to bring header/footer back when hidden -->
    <div id="chrome-reveal-zone" class="chrome-reveal-zone"></div>
  </div>

  <!-- Click zones for navigation -->
  <div class="click-zone click-zone-left" id="prev-zone"></div>
  <div class="click-zone click-zone-right" id="next-zone"></div>

  <!-- Settings Modal -->
  <div id="settings-modal" class="modal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Reading Settings</h2>
        <button id="close-modal" class="close-btn">&times;</button>
      </div>
      <div class="modal-body">
        <div class="setting-item">
          <label for="font-size">Font Size:</label>
          <select id="font-size">
            <option value="14">14px</option>
            <option value="16">16px</option>
            <option value="18" selected>18px</option>
            <option value="20">20px</option>
            <option value="24">24px</option>
            <option value="28">28px</option>
            <option value="32">32px</option>
            <option value="36">36px</option>
            <option value="40">40px</option>
            <option value="44">44px</option>
            <option value="48">48px</option>
          </select>
        </div>
        <div class="setting-item">
          <label for="font-family">Font Family:</label>
          <select id="font-family">
            <option value="Georgia, serif" selected>Georgia</option>
            <option value="'Times New Roman', Times, serif">Times New Roman</option>
            <option value="'Palatino Linotype', 'Book Antiqua', Palatino, serif">Palatino</option>
            <option value="'Arial', sans-serif">Arial</option>
            <option value="'Helvetica', sans-serif">Helvetica</option>
            <option value="'LXGW WenKai', serif">霞鹜文楷 (LxgwWenKai)</option>
            <option value="'Noto Serif SC', serif">思源宋体 (Noto Serif SC)</option>
            <option value="FangSong, STFangsong, serif">仿宋 (FangSong)</option>
            <option value="'PingFang SC', 'Microsoft YaHei', sans-serif">苹方/微软雅黑</option>
          </select>
        </div>
        <div class="setting-item">
          <label for="line-height">Line Height:</label>
          <select id="line-height">
            <option value="1.4">1.4</option>
            <option value="1.5">1.5</option>
            <option value="1.6">1.6</option>
            <option value="1.7" selected>1.7</option>
            <option value="1.8">1.8</option>
            <option value="2.0">2.0</option>
          </select>
        </div>
      </div>
      <div class="modal-footer">
        <button id="save-settings" class="btn-primary">Save</button>
        <button id="cancel-settings" class="btn-secondary">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Page Navigation Modal -->
  <div id="page-nav-modal" class="modal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Jump to Page</h2>
        <button id="close-page-nav-modal" class="close-btn">&times;</button>
      </div>
      <div class="modal-body">
        <div class="page-nav-actions">
          <button id="jump-first-page" class="btn-secondary">⇤ First Page</button>
          <button id="jump-last-page" class="btn-secondary">Last Page ⇥</button>
        </div>
        <div class="page-jump-input">
          <label for="page-jump-number">Go to page:</label>
          <input type="number" id="page-jump-number" min="1" value="1">
          <button id="page-jump-btn" class="btn-primary">Go</button>
        </div>
      </div>
    </div>
  </div>

  <div id="loading">Loading article...</div>
  <div id="error" style="display: none;">Failed to load article content.</div>

  <script src="lib/supabase.js"></script>
  <script src="js/config.js"></script>
  <script src="js/offline-cache.js"></script>
  <script src="js/common.js"></script>
  <script src="js/reader.js"></script>

  <!-- Service Worker Registration -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/service-worker.js')
          .then((registration) => {
            console.log('SW registered:', registration.scope);
          })
          .catch((error) => {
            console.error('SW registration failed:', error);
          });
      });
    }
  </script>
</body>
</html>
